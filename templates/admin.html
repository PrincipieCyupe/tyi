<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TYI Admin Portal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='images/Group_55.png') }}" type="image/x-icon">
</head>
<body class="bg-gray-900 text-white">
    
    <!-- Header -->
    <div class="bg-gray-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <a href="{{ url_for('home') }}" class="flex-shrink-0">
                        <img src="{{ url_for('static', filename='images/Group_55.png') }}" alt="TYI Logo" class="h-10 w-auto" />
                    </a>
                    <h1 class="text-xl sm:text-2xl font-bold text-white">TYI Admin Portal</h1>
                </div>
                <a href="{{ url_for('admin_logout') }}" class="bg-red-500 hover:bg-red-600 text-white px-3 sm:px-4 py-2 rounded-lg transition text-sm sm:text-base">
                    Logout
                </a>
            </div>
        </div>
    </div>

    <!-- Flash Messages (Auto-dismiss after 5 seconds) -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
                {% for category, message in messages %}
                    <div data-flash-message class="bg-{% if category == 'success' %}green{% elif category == 'danger' %}red{% else %}blue{% endif %}-500/10 border border-{% if category == 'success' %}green{% elif category == 'danger' %}red{% else %}blue{% endif %}-500/20 text-{% if category == 'success' %}green{% elif category == 'danger' %}red{% else %}blue{% endif %}-400 px-4 py-3 rounded-lg mb-2">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Navigation Tabs -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
        <div class="flex overflow-x-auto space-x-1 border-b border-gray-700 scrollbar-hide">
            <button onclick="showTab('courses')" id="tab-courses" class="tab-button px-4 sm:px-6 py-3 font-semibold text-indigo-400 border-b-2 border-indigo-400 cursor-pointer whitespace-nowrap">
                Courses
            </button>
            <button onclick="showTab('progress')" id="tab-progress" class="tab-button px-4 sm:px-6 py-3 font-semibold text-gray-400 hover:text-white cursor-pointer whitespace-nowrap">
                Progress
            </button>
            <button onclick="showTab('opportunities')" id="tab-opportunities" class="tab-button px-4 sm:px-6 py-3 font-semibold text-gray-400 hover:text-white cursor-pointer whitespace-nowrap">
                Opportunities
            </button>
            <button onclick="showTab('events')" id="tab-events" class="tab-button px-4 sm:px-6 py-3 font-semibold text-gray-400 hover:text-white cursor-pointer whitespace-nowrap">
                Events
            </button>
            <button onclick="showTab('blogs')" id="tab-blogs" class="tab-button px-4 sm:px-6 py-3 font-semibold text-gray-400 hover:text-white cursor-pointer whitespace-nowrap">
                Blogs
            </button>
            <button onclick="showTab('activities')" id="tab-activities" class="tab-button px-4 sm:px-6 py-3 font-semibold text-gray-400 hover:text-white cursor-pointer whitespace-nowrap">
                Activities
            </button>
            <button onclick="showTab('message')" id="tab-message" class="tab-button px-4 sm:px-6 py-3 font-semibold text-gray-400 hover:text-white cursor-pointer whitespace-nowrap">
                Message
            </button>
            <button onclick="showTab('users')" id="tab-users" class="tab-button px-4 sm:px-6 py-3 font-semibold text-gray-400 hover:text-white cursor-pointer whitespace-nowrap">
                Users
            </button>
            <button onclick="showTab('leaderboard')" id="tab-leaderboard" class="tab-button px-4 sm:px-6 py-3 font-semibold text-gray-400 hover:text-white cursor-pointer whitespace-nowrap">
                Leaderboard
            </button>
        </div>
    </div>

    <!-- Tab Content Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- COURSES TAB -->
        <div id="content-courses" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
                
                <!-- Add Course Form -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">Add New Course</h2>
                    <form action="{{ url_for('admin_add_course') }}" method="POST">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Course Title</label>
                                <input type="text" name="title" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                <textarea name="description" rows="3" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Duration (weeks)</label>
                                    <input type="number" name="duration_weeks" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Total Modules</label>
                                    <input type="number" name="total_modules" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Level</label>
                                <select name="level" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                    <option value="Beginner">Beginner</option>
                                    <option value="Intermediate">Intermediate</option>
                                    <option value="Advanced">Advanced</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg transition">
                                Add Course
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Courses List -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">All Courses ({{ courses|length }})</h2>
                    <div class="space-y-4 max-h-[600px] overflow-y-auto">
                        {% for course in courses %}
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-white">{{ course.title }}</h3>
                                        <p class="text-sm text-gray-400 mt-1">{{ course.description }}</p>
                                        <div class="flex gap-4 mt-2 text-xs text-gray-500">
                                            <span>{{ course.duration_weeks }} weeks</span>
                                            <span>{{ course.total_modules }} modules</span>
                                            <span>{{ course.level }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-2 mt-3">
                                    <a href="{{ url_for('admin_manage_course', course_id=course.id) }}" class="text-sm bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded transition">
                                        Manage Modules â†’
                                    </a>
                                    <form action="{{ url_for('admin_delete_course', course_id=course.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Delete this course and all enrollments?')">
                                        <button type="submit" class="text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded transition">
                                            Delete
                                        </button>
                                    </form>
                                </div>
                            </div>
                        {% else %}
                            <p class="text-gray-400 text-center py-8">No courses yet</p>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>

        <!-- PROGRESS MANAGEMENT TAB -->
        <div id="content-progress" class="tab-content hidden">
            <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">Manage User Progress</h2>
                <p class="text-gray-400 mb-6">Select a user to view and update their course progress.</p>
                <a href="{{ url_for('admin_progress') }}" class="inline-block rounded-md bg-indigo-500 px-6 py-3 text-base font-semibold text-white hover:bg-indigo-400 transition">
                    View All Users
                </a>
            </div>
        </div>

        <!-- APPLICATION OPPORTUNITIES TAB -->
        <div id="content-opportunities" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
                
                <!-- Create Opportunity Form -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">Create Application Opportunity</h2>
                    <form action="{{ url_for('admin_create_opportunity') }}" method="POST" enctype="multipart/form-data">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Title</label>
                                <input type="text" name="title" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                <textarea name="description" rows="3" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Requirements</label>
                                <textarea name="requirements" rows="2" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                            
                            <!-- NEW: Image Upload Field -->
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Cover Image</label>
                                <input type="file" name="cover_image" accept="image/*" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-indigo-600 file:text-white hover:file:bg-indigo-700 file:cursor-pointer">
                                <p class="text-xs text-gray-400 mt-1">ðŸ“¸ Optional: Upload a custom image (JPG, PNG). If not provided, default image will be used.</p>
                            </div>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Deadline</label>
                                    <input type="date" name="deadline" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Prize Amount</label>
                                    <input type="text" name="prize_amount" placeholder="100,000 RWF" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg transition">
                                Create Opportunity
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Opportunities List -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                        <h2 class="text-lg sm:text-xl font-semibold text-white">All Opportunities ({{ opportunities|length }})</h2>
                        <a href="{{ url_for('admin_applications') }}" class="text-sm bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition whitespace-nowrap">
                            View Applications â†’
                        </a>
                    </div>
                    <div class="space-y-4 max-h-[600px] overflow-y-auto">
                        {% for opp in opportunities %}
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-white">{{ opp.title }}</h3>
                                        <p class="text-sm text-gray-400 mt-1">{{ opp.description[:100] }}...</p>
                                        <div class="flex flex-wrap gap-4 mt-2 text-xs text-gray-500">
                                            <span>{{ opp.deadline.strftime('%b %d, %Y') }}</span>
                                            <span>{{ opp.prize_amount }}</span>
                                            <span class="{% if opp.status == 'open' %}text-green-400{% else %}text-red-400{% endif %}">{{ opp.status }}</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1 truncate">ðŸ“¸ {{ opp.cover_image }}</p>
                                    </div>
                                </div>
                                <div class="flex gap-2 mt-3">
                                    <form action="{{ url_for('admin_delete_opportunity', opp_id=opp.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Delete this opportunity?')">
                                        <button type="submit" class="text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded transition">
                                            Delete
                                        </button>
                                    </form>
                                </div>
                            </div>
                        {% else %}
                            <p class="text-gray-400 text-center py-8">No opportunities yet</p>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>

        <!-- EVENTS TAB -->
        <div id="content-events" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
                
                <!-- Create Event Form -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">Create Event/Deadline</h2>
                    <form action="{{ url_for('admin_create_event') }}" method="POST">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Title</label>
                                <input type="text" name="title" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                <textarea name="description" rows="3" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Event Date</label>
                                <input type="date" name="event_date" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Start Time</label>
                                    <input type="text" name="start_time" placeholder="2:00 PM" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">End Time</label>
                                    <input type="text" name="end_time" placeholder="5:00 PM" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Event Type</label>
                                <select name="event_type" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                    <option value="general">General Event</option>
                                    <option value="workshop">Workshop</option>
                                    <option value="deadline">Deadline (Red)</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg transition">
                                Create Event
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Events List -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">All Events ({{ events|length }})</h2>
                    <div class="space-y-4 max-h-[600px] overflow-y-auto">
                        {% for event in events %}
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-white">{{ event.title }}</h3>
                                        <p class="text-sm text-gray-400 mt-1">{{ event.description }}</p>
                                        <div class="flex flex-wrap gap-4 mt-2 text-xs text-gray-500">
                                            <span>{{ event.event_date.strftime('%b %d, %Y') }}</span>
                                            {% if event.start_time %}
                                                <span>{{ event.start_time }} - {{ event.end_time }}</span>
                                            {% endif %}
                                            <span class="{% if event.event_type == 'deadline' %}text-red-400{% else %}text-blue-400{% endif %}">{{ event.event_type }}</span>
                                        </div>
                                    </div>
                                </div>
                                <form action="{{ url_for('admin_delete_event', event_id=event.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Delete this event?')">
                                    <button type="submit" class="text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded transition mt-2">
                                        Delete
                                    </button>
                                </form>
                            </div>
                        {% else %}
                            <p class="text-gray-400 text-center py-8">No events yet</p>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>

        <!-- BLOG POSTS TAB -->
        <div id="content-blogs" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
                
                <!-- Create Blog Post Form -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">Create Blog Post</h2>
                    <form action="{{ url_for('admin_create_blog') }}" method="POST" enctype="multipart/form-data">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Title</label>
                                <input type="text" name="title" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Author</label>
                                <input type="text" name="author" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                <textarea name="description" rows="2" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">YouTube URL</label>
                                <input type="url" name="youtube_url" placeholder="https://youtube.com/watch?v=..." required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                            </div>
                            
                            <!-- NEW: Image Upload Field -->
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Cover Image</label>
                                <input type="file" name="cover_image" accept="image/*" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-indigo-600 file:text-white hover:file:bg-indigo-700 file:cursor-pointer">
                                <p class="text-xs text-gray-400 mt-1">ðŸ“¸ Optional: Upload a custom image (JPG, PNG). If not provided, default image will be used.</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Publish Date</label>
                                <input type="date" name="publish_date" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <button type="submit" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg transition">
                                Create Blog Post
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Blog Posts List -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">All Blog Posts ({{ blogs|length }})</h2>
                    <div class="space-y-4 max-h-[600px] overflow-y-auto">
                        {% for blog in blogs %}
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-white">{{ blog.title }}</h3>
                                        <p class="text-sm text-gray-400 mt-1">{{ blog.description }}</p>
                                        <div class="flex flex-wrap gap-4 mt-2 text-xs text-gray-500">
                                            <span>{{ blog.publish_date.strftime('%b %d, %Y') }}</span>
                                            <span>{{ blog.author }}</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1 truncate">ðŸ“¸ {{ blog.cover_image }}</p>
                                        <a href="{{ blog.youtube_url }}" target="_blank" class="text-xs text-blue-400 hover:underline mt-1 block break-all">{{ blog.youtube_url[:50] }}...</a>
                                    </div>
                                </div>
                                <form action="{{ url_for('admin_delete_blog', blog_id=blog.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Delete this blog post?')">
                                    <button type="submit" class="text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded transition mt-2">
                                        Delete
                                    </button>
                                </form>
                            </div>
                        {% else %}
                            <p class="text-gray-400 text-center py-8">No blog posts yet</p>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>

        <!-- ACTIVITY UPDATES TAB -->
        <div id="content-activities" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
                
                <!-- Create Activity Form -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">Create Activity Update</h2>
                    <form action="{{ url_for('admin_create_activity') }}" method="POST">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Title</label>
                                <input type="text" name="title" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                <textarea name="description" rows="3" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Update Type</label>
                                    <select name="update_type" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                        <option value="general">General</option>
                                        <option value="success">Success</option>
                                        <option value="warning">Warning</option>
                                        <option value="info">Info</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Icon Color</label>
                                    <select name="icon_color" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                        <option value="green">Green (Success)</option>
                                        <option value="blue">Blue (Info)</option>
                                        <option value="yellow">Yellow (Warning)</option>
                                        <option value="purple">Purple (Achievement)</option>
                                        <option value="red">Red (Alert)</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg transition">
                                Create Update
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Activities List -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">All Activity Updates ({{ activities|length }})</h2>
                    <div class="space-y-4 max-h-[600px] overflow-y-auto">
                        {% for activity in activities %}
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="flex items-start gap-3">
                                    <div class="flex-shrink-0 w-3 h-3 rounded-full bg-{{ activity.icon_color }}-500 mt-1"></div>
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-white">{{ activity.title }}</h3>
                                        <p class="text-sm text-gray-400 mt-1">{{ activity.description }}</p>
                                        <div class="flex flex-wrap gap-4 mt-2 text-xs text-gray-500">
                                            <span>{{ activity.created_at.strftime('%b %d, %Y') }}</span>
                                            <span class="text-{{ activity.icon_color }}-400">{{ activity.icon_color }} icon</span>
                                        </div>
                                    </div>
                                    <form action="{{ url_for('admin_delete_activity', activity_id=activity.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Delete this update?')">
                                        <button type="submit" class="text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded transition flex-shrink-0">
                                            Delete
                                        </button>
                                    </form>
                                </div>
                            </div>
                        {% else %}
                            <p class="text-gray-400 text-center py-8">No activity updates yet</p>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>

        <!-- SEND MESSAGE TAB -->
        <div id="content-message" class="tab-content hidden">
            <div class="max-w-2xl mx-auto bg-gray-800 rounded-lg p-4 sm:p-6">
                <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">Send Message to User</h2>
                <form action="{{ url_for('admin_send_message') }}" method="POST">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Select User</label>
                            <select name="user_id" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                {% for user in users %}
                                    <option value="{{ user.id }}">{{ user.get_full_name() }} ({{ user.email }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Message Title</label>
                            <input type="text" name="title" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Message Content</label>
                            <textarea name="content" rows="4" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500"></textarea>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Message Type</label>
                                <select name="message_type" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                    <option value="blue">Info (Blue)</option>
                                    <option value="green">Success (Green)</option>
                                    <option value="yellow">Warning (Yellow)</option>
                                    <option value="red">Error (Red)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Icon Type</label>
                                <select name="icon_type" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500">
                                    <option value="general">General</option>
                                    <option value="application">Application</option>
                                    <option value="course">Course</option>
                                    <option value="achievement">Achievement</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg transition">
                            Send Message
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- USERS TAB -->
        <div id="content-users" class="tab-content hidden">
            <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">All Users ({{ users|length }})</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for user in users %}
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-indigo-500 flex items-center justify-center font-bold text-white flex-shrink-0">
                                    {{ user.get_initials() }}
                                </div>
                                <div class="min-w-0">
                                    <h3 class="font-semibold text-white truncate">{{ user.get_full_name() }}</h3>
                                    <p class="text-sm text-gray-400 truncate">{{ user.email }}</p>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500">Joined: {{ user.created_at.strftime('%b %d, %Y') }}</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- LEADERBOARD TAB -->
        <div id="content-leaderboard" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
                
                <!-- Upload CSV Form -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 sm:mb-6">Upload Leaderboard CSV</h2>
                    
                    <div class="bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 mb-6">
                        <h3 class="text-sm font-semibold text-blue-400 mb-2">CSV Format Required:</h3>
                        <pre class="text-xs text-gray-300 bg-gray-900 p-3 rounded overflow-x-auto">rank,user_email,total_points,project_name,location
1,user@example.com,30,Project Name,Location
2,another@example.com,27,Another Project,City</pre>
                        <p class="text-xs text-gray-400 mt-2">â€¢ Each user email must match a registered user</p>
                        <p class="text-xs text-gray-400">â€¢ Rank should be unique (1, 2, 3...)</p>
                        <p class="text-xs text-gray-400">â€¢ Upload will create new or update existing entries</p>
                    </div>

                    <form action="{{ url_for('admin_upload_leaderboard') }}" method="POST" enctype="multipart/form-data">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Select CSV File</label>
                                <input type="file" name="csv_file" accept=".csv" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-indigo-500 file:text-white file:cursor-pointer hover:file:bg-indigo-600 file:text-sm">
                            </div>
                            <button type="submit" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg transition">
                                Upload & Update Leaderboard
                            </button>
                        </div>
                    </form>

                    <div class="mt-6 pt-6 border-t border-gray-700">
                        <h3 class="text-sm font-semibold text-white mb-3">Danger Zone</h3>
                        <form action="{{ url_for('admin_clear_leaderboard') }}" method="POST" onsubmit="return confirm('Clear entire leaderboard? This cannot be undone!')">
                            <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition">
                                Clear All Leaderboard Data
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Current Leaderboard Preview -->
                <div class="bg-gray-800 rounded-lg p-4 sm:p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                        <h2 class="text-lg sm:text-xl font-semibold text-white">Current Leaderboard</h2>
                        <a href="{{ url_for('admin_leaderboard') }}" class="text-sm bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition whitespace-nowrap">
                            View Full List â†’
                        </a>
                    </div>
                    <div class="space-y-4 max-h-[600px] overflow-y-auto">
                        {% set top_entries = [] %}
                        {% for entry in (LeaderboardEntry.query.order_by(LeaderboardEntry.rank).limit(10).all() if LeaderboardEntry else []) %}
                            {% set _ = top_entries.append(entry) %}
                        {% endfor %}
                        
                        {% if top_entries %}
                            {% for entry in top_entries %}
                                <div class="bg-gray-700 rounded-lg p-4 flex flex-col sm:flex-row items-start sm:items-center gap-4">
                                    <div class="flex-shrink-0 w-10 h-10 rounded-full {% if entry.rank == 1 %}bg-yellow-500{% elif entry.rank == 2 %}bg-gray-400{% elif entry.rank == 3 %}bg-orange-600{% else %}bg-gray-600{% endif %} flex items-center justify-center font-bold text-white">
                                        {{ entry.rank }}
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h3 class="font-semibold text-white truncate">{{ entry.user.get_full_name() }}</h3>
                                        <p class="text-sm text-gray-400 truncate">{{ entry.project_name }} â€¢ {{ entry.location }}</p>
                                        <p class="text-xs text-gray-500 mt-1 truncate">{{ entry.user.email }}</p>
                                    </div>
                                    <div class="text-right flex-shrink-0">
                                        <p class="text-xl sm:text-2xl font-bold text-indigo-400">{{ entry.total_points }}</p>
                                        <p class="text-xs text-gray-500">points</p>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-gray-400 text-center py-8">No leaderboard entries yet. Upload a CSV to get started!</p>
                        {% endif %}
                    </div>
                </div>

            </div>
        </div>

    </div>

    <!-- Flash Message Auto-dismiss Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
          const flashMessages = document.querySelectorAll('[data-flash-message]');
          
          flashMessages.forEach(function(message) {
            setTimeout(function() {
              message.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
              message.style.opacity = '0';
              message.style.transform = 'translateX(100%)';
              setTimeout(function() {
                message.remove();
              }, 500);
            }, 5000); // Auto-dismiss after 5 seconds
          });
        });
    </script>

    <!-- Tab Switching JavaScript -->
    <script>
        function showTab(tabName) {
            // Hide all tab content
            const allContent = document.querySelectorAll('.tab-content');
            allContent.forEach(content => content.classList.add('hidden'));
            
            // Remove active state from all buttons
            const allButtons = document.querySelectorAll('.tab-button');
            allButtons.forEach(button => {
                button.classList.remove('text-indigo-400', 'border-b-2', 'border-indigo-400');
                button.classList.add('text-gray-400');
            });
            
            // Show selected tab content
            document.getElementById('content-' + tabName).classList.remove('hidden');
            
            // Add active state to clicked button
            const activeButton = document.getElementById('tab-' + tabName);
            activeButton.classList.remove('text-gray-400');
            activeButton.classList.add('text-indigo-400', 'border-b-2', 'border-indigo-400');
        }
    </script>

</body>
</html>
